<!DOCTYPE html>
<html lang="pt-BR" class=""> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Integração com Chatwoot</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Font Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb', 
                        secondary: '#10b981', 
                        dark: '#1e293b',    
                        light: '#f8fafc',   
                        gray: {
                           ...tailwind.colors.gray, 
                           600: '#4b5563', 
                           700: '#374151', 
                           800: '#1f2937', 
                           900: '#111827'  
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'], 
                    },
                    ringColor: { 
                       DEFAULT: '#2563eb',
                       primary: '#2563eb',
                    },
                }
            }
        }
    </script>

    <!-- Script Dark Mode -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.documentElement.classList.add('dark')
        } else {
          document.documentElement.classList.remove('dark')
        }
    </script>

</head>
<body class="font-sans bg-light dark:bg-dark text-dark dark:text-light antialiased">

    <!-- Container com padding (removido max-width e mx-auto, padding pode ser ajustado p-4 ou p-2 se necessário) -->
    <div class="p-4"> 

        <!-- Título (pode diminuir o mb-6 para mb-4 se precisar de mais espaço vertical) -->
        <h1 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Formulário de Integração</h1>

        <form id="contact-form" class="space-y-4">

            <!-- Campo Nome -->
            <div>
                <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    required 
                    placeholder="Nome completo" 
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm 
                           bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100
                           placeholder-gray-400 dark:placeholder-gray-500
                           focus:ring-primary focus:border-primary focus:ring-1 
                           transition duration-150 ease-in-out text-sm"> {/* Adicionado text-sm */}
            </div>

            <!-- Campo Email -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    required 
                    placeholder="seu@email.com" 
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                           bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100
                           placeholder-gray-400 dark:placeholder-gray-500
                           focus:ring-primary focus:border-primary focus:ring-1 
                           transition duration-150 ease-in-out text-sm"> {/* Adicionado text-sm */}
            </div>

            <!-- Campo Telefone -->
            <div>
                <label for="phone" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Telefone</label>
                <input 
                    type="tel" 
                    id="phone" 
                    name="phone" 
                    placeholder="(XX) XXXXX-XXXX" 
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                           bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100
                           placeholder-gray-400 dark:placeholder-gray-500
                           focus:ring-primary focus:border-primary focus:ring-1 
                           transition duration-150 ease-in-out text-sm"> {/* Adicionado text-sm */}
            </div>

            <!-- Campo Mensagem -->
            <div>
                <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mensagem</label>
                <textarea 
                    id="message" 
                    name="message" 
                    placeholder="Digite sua mensagem aqui..." 
                    rows="4" {/* Reduzido rows para economizar espaço vertical */}
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm
                           bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100
                           placeholder-gray-400 dark:placeholder-gray-500
                           focus:ring-primary focus:border-primary focus:ring-1 
                           transition duration-150 ease-in-out text-sm"></textarea> {/* Adicionado text-sm */}
            </div>

            <!-- Botão Enviar -->
            <button 
                type="submit" 
                class="w-full bg-primary text-white font-bold py-2 px-4 rounded-md 
                       hover:bg-opacity-90 dark:hover:bg-opacity-80 
                       focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary 
                       dark:focus:ring-offset-dark transition duration-300 ease-in-out text-sm"> {/* Adicionado text-sm */}
                Enviar
            </button>
        </form>
    </div>

    <!-- SEU SCRIPT EXISTENTE (Chatwoot + N8N) -->
    <script>
        // ... (seu script JS existente aqui) ...
        // --- CÓDIGO EXISTENTE DO CHATWOOT ---
        console.log("Formulário Script Iniciado.");
        window.addEventListener("message", function (event) {
            console.log("Mensagem recebida:", event.data);
             try {
                if (typeof event.data === 'string' && event.data.startsWith('{')) {
                    const eventData = JSON.parse(event.data);
                    if (eventData && eventData.event === "appContext" && eventData.data && eventData.data.contact) {
                        const contact = eventData.data.contact;
                        console.log("Preenchendo dados do contato:", contact);
                        const nameField = document.getElementById('name');
                        const emailField = document.getElementById('email');
                        const phoneField = document.getElementById('phone');
                        if(nameField) nameField.value = contact.name || '';
                        if(emailField) emailField.value = contact.email || '';
                        if(phoneField) phoneField.value = contact.phone_number || '';
                    }
                }
             } catch (error) {
                 console.error("Erro ao processar mensagem do Chatwoot:", error);
             }
        });
        console.log("Enviando 'chatwoot-dashboard-app:fetch-info' para o parent.");
        if (window.parent && window.parent !== window) {
           window.parent.postMessage('chatwoot-dashboard-app:fetch-info', '*');
        } else {
           console.warn("Rodando fora de um iframe ou window.parent não acessível.");
        }
        // --- FIM DO CÓDIGO CHATWOOT ---


        // --- CÓDIGO PARA SUBMISSÃO PARA O N8N ---
        const contactForm = document.getElementById('contact-form');
        const webhookUrl = 'https://workflows.dubcom.com.br/webhook/3f858fbf-abf0-44a3-903b-ce27ca28de5d';

        if (contactForm) {
            contactForm.addEventListener('submit', function(event) {
                event.preventDefault(); 
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const message = document.getElementById('message').value;
                const formData = { name, email, phone, message };
                console.log('Enviando os seguintes dados para o n8n:', formData); 

                fetch(webhookUrl, {
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData), 
                })
                .then(response => {
                    if (!response.ok) {
                        return response.text().then(text => { throw new Error(`Erro Webhook: ${response.status} - ${text}`); });
                    }
                    return response.json().catch(() => ({ success: true, status: response.status }));
                })
                .then(data => {
                    console.log('Sucesso! Resposta n8n:', data);
                    alert('Dados enviados com sucesso!'); 
                    // contactForm.reset(); 
                })
                .catch((error) => {
                    console.error('Erro ao enviar dados para n8n:', error);
                    alert(`Erro ao enviar: ${error.message}`); 
                });
            });
        } else {
            console.error("Elemento do formulário com ID 'contact-form' não encontrado!");
        }
        // --- FIM DO CÓDIGO N8N ---
    </script>

</body>
</html>